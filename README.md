# SotiMediaOrganizer (SMO)

**SotiMediaOrganizer** (SMO) is your ultimate solution for organizing and decluttering your digital photo and video collection. Whether you're a casual snapper or a professional photographer, SMO provides the tools you need to make sense of thousands of files‚Äîquickly, efficiently, and smartly.

## üöÄ Features at a Glance

- **Intelligent Organization**: Automatically sorts your photos and videos based on metadata like creation date, geolocation, and camera model.
- **Cutting-Edge Deduplication**: Detects and groups duplicates with precision using advanced algorithms such as MinHash, VP Tree, and DBSCAN.
- **Performance First**: Optimized for both Windows and Ubuntu, leveraging powerful tools like Sharp and FFmpeg for downscaling, ensuring a fast and smooth experience.
- **Customizable Directory Structure**: Tailor the organization to fit your style with a flexible format string system.
- **Resume Anytime**: A robust caching mechanism ensures you can pause and resume deduplication at your convenience.
- **HEIC and DNG Support**: Need to process HEIC or DNG files? No problem‚Äîjust recompile libvips following their guidelines.

## üåü Installation

Install SMO globally with Bun:

```bash
bun install --global @sotilab/smo
```

This command makes `smo` available directly from your terminal.

## üî• Usage

Here‚Äôs how to get started with SMO. The command structure is designed to be intuitive and flexible:

```bash
smo -s /path/to/source -t /path/to/target
```

### Command Options

- **Required:**
  - `-s, --source <paths...>`: Source directories containing your media files.
  - `-t, --target <path>`: Target directory where organized files will be stored.
- **Optional:**
  - `-e, --error <path>`: Directory for files that couldn't be processed.
  - `-d, --duplicate <path>`: Directory where duplicate files will be stored.
  - `--debug <path>`: Directory for storing all files in duplicate sets for debugging purposes.
  - `-c, --concurrency <number>`: Number of workers to use (default: half of CPU cores).
  - `-m, --move`: Move files instead of copying them.
  - `-r, --resolution <number>`: Resolution for perceptual hashing (default: 64).
  - `--frame-count <number>`: Number of frames to extract from videos for perceptual hashing (default: 5).
  - `-s, --similarity <number>`: Similarity threshold for perceptual hashing (default: 0.99).
  - `-f, --format <string>`: Format for target directory structure.

### Example

Organize media from multiple source directories into a target directory with custom formats and duplicate handling:

```bash
smo -s /media/photos /media/videos -t /organized/media -d /duplicates -e /errors --move --format "{D.YYYY}/{D.MM}/{D.DD}/{NAME}.{EXT}"
```

### Format String Placeholders

SMO gives you the power to define how your files are organized with a rich set of placeholders:

- **Image/Video Date (I., F., D.):**
  - `{*.YYYY}`: Year (4 digits)
  - `{*.MM}`: Month (2 digits)
  - `{*.DD}`: Day (2 digits)
  - `{*.HH}`: Hour (24h, 2 digits)
  - `{*.mm}`: Minute (2 digits)
- **Filename:**
  - `{NAME}`: Original filename (without extension)
  - `{EXT}`: File extension (without dot)
  - `{RND}`: Random 8-character hexadecimal string
- **Other:**
  - `{GEO}`: Geolocation
  - `{CAM}`: Camera model
  - `{TYPE}`: 'Image' or 'Other'

#### Example Formats:

```bash
"{D.YYYY}/{D.MM}/{D.DD}/{NAME}.{EXT}"
"{HAS.GEO}/{D.YYYY}/{D.MM}/{NAME}_{D.HH}{D.mm}.{EXT}"
```

## üîç Deduplication Explained

SMO‚Äôs deduplication process is a masterpiece of modern technology, designed to carefully analyze and group similar files while preserving important moments and discarding unnecessary duplicates.

### How SMO Treats Videos and Images the Same

SMO is built to handle both videos and images, treating them with the same level of care and precision during deduplication. This approach is essential because there are animated images (like GIFs) and one-frame videos (such as short clips) that need to be managed similarly to static images. This capability allows SMO to deduplicate across videos and images seamlessly, ensuring a cleaner and more organized media library.

### üèÜ Selecting the Best Files from Clusters

SMO doesn‚Äôt just identify duplicates‚Äîit carefully selects the best files to keep. This process is essential because sometimes a video might capture the same moment as a photo, which you might want to preserve. Other times, those photos could just be thumbnails generated by software, which you don‚Äôt need. Here‚Äôs how SMO makes sure you only keep the files that matter most:

#### ü•á Step 1: Prioritize Like a Pro

First, SMO sorts all the files in a cluster based on a series of criteria designed to pick the best possible file:

1. **Effective Frames**: Files with more effective frames (i.e., frames with meaningful content) are prioritized. This ensures that videos or animated images are favored over single-frame entries if they contain more substantial content.
2. **Duration**: Longer videos or animations are preferred, as they likely capture more of the moment.
3. **Image Date**: Files with an embedded image date are more valuable because they give you a precise timestamp.
4. **Geolocation**: Files that include geolocation data are prioritized next, providing context for where the media was captured.
5. **Camera Model**: Files with specific camera model information are also given priority, helping ensure consistency in quality and format.
6. **Quality and Size**: Finally, files with higher quality and larger file sizes are favored, ensuring that the most detailed and high-resolution media is preserved.

#### üé¨ Step 2: Picking the Best Entry‚ÄîTwo Scenarios

After prioritizing the files, SMO then decides the best approach to take based on the type of content:

1. **One-Frame Entry (Photo or Thumbnail)**:

   - **Case**: The best file in the cluster is a one-frame entry (either a photo or a one-frame video).
   - **Approach**: Since SMO has already prioritized files with more frames, this one-frame entry likely represents a key moment. SMO then groups all other one-frame entries, considering them as possible captures of that moment.

   **Example**: You have a photo and a one-frame video both showing the same sunset. Since they‚Äôre essentially the same, SMO will keep the best one and discard the other.

2. **Multi-Frame Entry (Video or Animation)**:

   - **Case**: The best file in the cluster is a multi-frame entry, like a video or an animated image.
   - **Approach**: This situation is trickier. Some of the one-frame entries might be genuine captures from this video (e.g., a keyframe you captured while watching the video), while others might be thumbnails generated by software. Here‚Äôs how SMO handles this:
     1. **Quality Check**: SMO picks all one-frame entries that have the same or better quality as the multi-frame entry.
     2. **Date Matching**: If the multi-frame entry has an image date, SMO requires that these one-frame entries also have an image date. This ensures that the captures are genuine and not just random thumbnails.
     3. **Final Deduplication**: SMO then performs deduplication on these selected files, ensuring that any genuine captures are preserved, while unnecessary thumbnails are discarded.

   **Example**: Imagine you have a video of your child‚Äôs first steps and a few photos. SMO identifies the video as the best entry. It then checks if the photos are actual captures of that moment (e.g., taken with the same camera at the same time) or just thumbnails generated by some software. SMO will keep the genuine captures and discard the rest.

### Why SMO Deduplicates the Cluster Again

You might wonder why SMO goes through the process of deduplicating the cluster again after selecting the best files. This step is crucial because of the nuances in how media is captured and stored:

- **User-Captured Moments**: Sometimes, users capture a moment from a video, resulting in a photo or screenshot that they want to keep. These captures are valuable and should be preserved alongside the original video.
- **Software-Generated Thumbnails**: On the other hand, some one-frame entries might be thumbnails generated automatically by software. These are often redundant and not worth keeping.

By deduplicating the cluster again, SMO ensures that only the most meaningful files are kept, giving you a clean, organized media collection without losing any important memories.

### üèéÔ∏è Performance Optimizations

SMO doesn‚Äôt just work‚Äîit flies:

- **Downscaling**: Before comparison, media files are downscaled using Sharp and FFmpeg, reducing data size while maintaining key features.
- **Concurrency**: SMO uses multiple CPU cores to process files in parallel, maximizing speed and efficiency.
- **Caching**: The deduplication

stage includes a caching mechanism so that you can pause and resume without losing progress.

### Supported Formats

SMO supports most common image and video formats. For HEIC or DNG support, you need to recompile libvips:

```bash
./configure --with-heic --with-dng
make
sudo make install
```

## ü§ù Contributing

We welcome contributions from the community! Feel free to fork the repository, make your changes, and submit a pull request.

## üìù License

SMO is open-source software, licensed under the MIT License.
